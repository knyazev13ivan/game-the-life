!function(){"use strict";class t{constructor(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.fitToContainer=this.fitToContainer.bind(this),addEventListener("resize",this.fitToContainer),this.fitToContainer()}fitToContainer(){this.w=this.canvas.width=this.canvas.clientWidth,this.h=this.canvas.height=this.canvas.clientHeight}}class e{constructor(t,e){this.req=0,this.update=t,this.display=e,this.deltaTime=0,this.lastUpdate=0,this.maxInterval=40,this.minInterval=30,requestAnimationFrame((t=>this.animate(t)))}animate(t){this.req=requestAnimationFrame((t=>this.animate(t))),this.deltaTime=t-this.lastUpdate,this.deltaTime<this.maxInterval&&(this.update(this.deltaTime/1e3),this.display()),this.lastUpdate=t}stop(){window.cancelAnimationFrame(this.req)}}function i(t,e,i,s=.8){return new Array(i).fill(new Array(e).fill(0)).map((t=>t.map((t=>Math.round(2*Math.random()*s)))))}function s(t){t.matrix=new Array(t.hSize).fill(new Array(t.wSize).fill(0)).map((e=>new Array(t.wSize).fill(0))),t.display()}const n=stP,a=new class{constructor(){this.getPresets=this.getPresets.bind(this),this.savePreset=this.savePreset.bind(this),this.ok=this.ok.bind(this),this.presets=this.getPresets(),this.presetsContainer=document.querySelector(".game-presets-list"),this.modal=document.querySelector(".modal-to-save-preset-container"),this.name=document.querySelector(".modal-to-save-preset__name"),this.warning=document.querySelector(".modal-to-save-preset__warning"),this.okButton=document.querySelector(".modal-to-save-preset-control__ok")}getPresets(){const t=n.slice(0);for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);t.push([i,JSON.parse(localStorage.getItem(i))])}return t}renderPresets(t){for(const t of this.presets){const e=document.createElement("li");e.textContent=t[0],e.classList.add("game-presets-list__item"),this.presetsContainer.append(e)}}savePreset(t,e){this.newPreset=JSON.stringify(e),localStorage.setItem(t,this.newPreset),this.presets.push([t,e])}showModal(){this.modal.style.display="flex",this.warning.style.display="none"}ok(t,e){if(t&&!localStorage.getItem(t)){this.savePreset(t,e);const i=document.createElement("li");i.textContent=t,i.classList.add("game-presets-list__item"),this.presetsContainer.append(i),this.modal.style.display="none"}else this.warning.style.display="block"}cancel(){this.modal.style.display="none"}},o=new class{constructor(s){this.isRun=!0,this.isEdit=!1,this.layer=new t(s),this.container=s,this.cellSize=2,this.wSize=Math.floor(this.layer.w/(this.cellSize+1)),this.hSize=Math.floor(this.layer.h/(this.cellSize+1)),this.matrix=new Array(this.hSize).fill(new Array(this.wSize).fill(0)),this.matrix=i(this.matrix,this.wSize,this.hSize,.8),this.loop=new e(this.update.bind(this),this.display.bind(this)),this.handler=this.handler.bind(this)}update(t){this.matrix=function(t){var e,i,s,n,a,o;let l=0;const r=t.slice(0).map(((e,i)=>t[i].slice(0)));for(let c=0;c<t.length;c++)for(let h=0;h<t[0].length;h++)l=0,(null===(e=t[c-1])||void 0===e?void 0:e[h-1])&&l++,(null===(i=t[c-1])||void 0===i?void 0:i[h])&&l++,(null===(s=t[c-1])||void 0===s?void 0:s[h+1])&&l++,t[c][h-1]&&l++,t[c][h+1]&&l++,(null===(n=t[c+1])||void 0===n?void 0:n[h-1])&&l++,(null===(a=t[c+1])||void 0===a?void 0:a[h])&&l++,(null===(o=t[c+1])||void 0===o?void 0:o[h+1])&&l++,2===l||3===l?(r[c][h]=t[c][h],3===l&&(r[c][h]=1)):r[c][h]=0;return r}(this.matrix)}display(){var t,e,i;this.layer.context.clearRect(0,0,this.layer.w,this.layer.h),t=this.matrix,e=this.cellSize,i=this.layer,t.forEach(((t,s)=>t.forEach(((t,n)=>{if(t){const t=n*(e+1),a=s*(e+1);i.context.fillStyle="#aa77cc",i.context.fillRect(t,a,e,e)}}))))}edit(){this.isRun&&this.loop.stop(),this.isEdit?(this.isEdit=!this.isEdit,this.container.removeEventListener("click",this.handler,!0)):(this.isEdit=!this.isEdit,this.container.addEventListener("click",this.handler,!0))}handler(t){if(t.target===this.container){const e=Math.floor((t.clientX-this.layer.canvas.offsetLeft)/(this.cellSize+1)),i=Math.floor((t.clientY-this.layer.canvas.offsetTop)/(this.cellSize+1));this.matrix[i][e]=this.matrix[i][e]?0:1,this.display()}}}(document.querySelector("body"));onload=()=>{a.renderPresets(a.presets)};const l=document.querySelector(".game-presets-list");null==l||l.addEventListener("click",(t=>{const e=t.target;if(null==e?void 0:e.classList.contains("game-presets-list__item")){o.isRun=!1,r.textContent="start",o.loop.stop(),o.isRun=!1,r.textContent="start",r.style.color="#409900";const t=e.textContent;s(o),a.presets.forEach((e=>{e[0]===t&&function(t,e){let i=Math.floor((e[0].length-t[0].length)/2),s=Math.floor(e.length-t.length);i<0&&(i=0),s<0&&(s=0);const n=Math.min(e.length,t.length),a=Math.min(e[0].length,t[0].length);for(let o=0;o<n;o++)for(let n=0;n<a;n++)e[o+s][n+i]=t[o][n]}(e[1],o.matrix),o.display()}))}}));const r=document.querySelector(".game-control__start");r.addEventListener("click",(()=>{o.isRun?(o.isRun=!1,r.textContent="start",r.style.color="#409900",o.loop.stop()):(o.isRun=!0,r.textContent="stop",r.style.color="#8855aa",o.loop.req=requestAnimationFrame((t=>o.loop.animate(t))))})),document.querySelector(".game-control__random").addEventListener("click",(()=>{o.matrix=i(o.matrix,o.wSize,o.hSize,.8),o.update(40),o.display()})),document.querySelector(".game-control__step").addEventListener("click",(()=>{o.update(40),o.display()})),document.querySelector(".game-control__clear").addEventListener("click",(()=>s(o)));const c=document.querySelector(".game-control__edit");c.addEventListener("click",(()=>{o.edit(),o.isEdit?(c.textContent="stop editing",c.style.color="#409900",r.style.color="#999999",r.disabled=!0):(c.textContent="edit",c.style.color="#8855aa",r.style.color="#8855aa",r.disabled=!1)})),document.querySelector(".game-presets__save").addEventListener("click",(()=>{o.loop.stop(),a.showModal()}));const h=document.querySelector(".modal-to-save-preset-control__ok"),d=document.querySelector(".modal-to-save-preset__name");h.addEventListener("click",(()=>{a.ok(d.value,o.matrix)})),document.querySelector(".modal-to-save-preset-control__cancel").addEventListener("click",(()=>{a.cancel()}))}();